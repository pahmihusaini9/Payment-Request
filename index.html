<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Payment Request Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- penting untuk mobile -->

  <style>
    body { 
      font-family: Arial, sans-serif; 
      max-width: 1000px; 
      margin: auto; 
      padding: 20px; 
    }
    h1, h2 { text-align: center; }

    label { font-weight: bold; }
    input { 
      width: 100%; 
      padding: 8px; 
      margin-bottom: 12px; 
      border: 1px solid #ccc; 
      border-radius: 5px;
    }

    table { 
      width: 100%; 
      border-collapse: collapse; 
      margin-top: 20px; 
    }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 8px; text-align: center; }
    button { 
      margin-top: 10px; 
      padding: 10px 16px; 
      border: none; 
      border-radius: 6px; 
      background: #007BFF; 
      color: white; 
      cursor: pointer; 
    }
    button:hover { background: #0056b3; }

    /* Responsive khusus untuk HP */
    @media (max-width: 768px) {
      body { padding: 10px; }

      table, thead, tbody, th, td, tr { 
        display: block; 
        width: 100%; 
      }

      thead tr { display: none; } /* header tabel disembunyikan */

      tbody tr { 
        margin-bottom: 15px; 
        border: 1px solid #ddd; 
        border-radius: 8px;
        padding: 10px;
      }

      td { 
        text-align: left; 
        padding: 6px; 
        border: none; 
        border-bottom: 1px solid #eee; 
        position: relative;
      }

      td::before { 
        content: attr(data-label); 
        font-weight: bold; 
        display: block; 
        margin-bottom: 4px; 
        color: #555;
      }

      input { font-size: 14px; }
      button { width: 100%; }
    }
  </style>
</head>
<body>
  <h1>Payment Request Form</h1>
  <h2>TIARA HANA INDONESIA</h2>

  <label>Date:</label>
  <input type="date" id="date">

  <label>Department:</label>
  <input type="text" id="department">

  <label>PIC:</label>
  <input type="text" id="pic">

  <label>Bill To (Name):</label>
  <input type="text" id="billToName">

  <label>Bill To (Rek):</label>
  <input type="text" id="billToRek">

  <h3>Items</h3>
  <table id="itemsTable">
    <thead>
      <tr>
        <th>Product Name</th>
        <th>Description</th>
        <th>Amount</th>
        <th>Qty</th>
        <th>Gross Price</th>
        <th>Discount</th>
        <th>Tax</th>
        <th>Net Price</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button type="button" id="addRowBtn">Add Row</button>

  <br><br>
  <button type="button" id="submitBtn">Submit Request</button>

  <p id="status"></p>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbwT6V-EN31TQjEOetQcqRe8Ea59NwVGpFrsE2vNaR8/dev";

    // Tambah row ke tabel
    function addRow() {
      const table = document.querySelector("#itemsTable tbody");
      const row = table.insertRow();

      const fields = ["Product Name", "Description", "Amount", "Qty", "Gross Price", "Discount", "Tax", "Net Price"];
      fields.forEach(f => {
        const cell = row.insertCell();
        const input = document.createElement("input");
        input.type = "text";
        input.name = f.replace(/\s+/g, "").toLowerCase(); // misal "Product Name" jadi "productname"
        cell.setAttribute("data-label", f);
        cell.appendChild(input);
      });

      // Tombol delete
      const actionCell = row.insertCell();
      actionCell.setAttribute("data-label", "Action");
      const btn = document.createElement("button");
      btn.innerText = "Delete";
      btn.type = "button";
      btn.onclick = () => row.remove();
      actionCell.appendChild(btn);
    }

    // Submit form
    async function submitForm() {
      const date = document.getElementById("date").value;
      const department = document.getElementById("department").value;
      const pic = document.getElementById("pic").value;
      const billToName = document.getElementById("billToName").value;
      const billToRek = document.getElementById("billToRek").value;

      const rows = document.querySelectorAll("#itemsTable tbody tr");
      const items = [];
      rows.forEach(r => {
        const inputs = r.querySelectorAll("input");
        items.push({
          productName: inputs[0].value,
          description: inputs[1].value,
          amount: inputs[2].value,
          qty: inputs[3].value,
          grossPrice: inputs[4].value,
          discount: inputs[5].value,
          tax: inputs[6].value,
          netPrice: inputs[7].value
        });
      });

      const data = { date, department, pic, billToName, billToRek, items };

      document.getElementById("status").innerText = "Submitting...";

      try {
        const response = await fetch(scriptURL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });
        
        const result = await response.json();
        if (result.result === "success") {
          document.getElementById("status").innerText = "✅ Submitted successfully!";
        } else {
          document.getElementById("status").innerText = "❌ Error: " + result.message;
        }
      } catch (err) {
        document.getElementById("status").innerText = "❌ Failed to connect to server.";
      }
    }

    // Event listener tombol
    document.getElementById("addRowBtn").addEventListener("click", addRow);
    document.getElementById("submitBtn").addEventListener("click", submitForm);
  </script>
</body>
</html>
