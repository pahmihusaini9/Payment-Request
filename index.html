<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Payment Request</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 1000px; margin: auto; padding: 20px; }
    h1 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 8px; text-align: center; }
    button { margin-top: 10px; padding: 8px 16px; }
    input { width: 100%; padding: 6px; }
  </style>
</head>
<body>
  <h1>Payment Request Form</h1>

  <label>Date:</label>
  <input type="date" id="date"><br><br>

  <label>Department:</label>
  <input type="text" id="department"><br><br>

  <label>PIC:</label>
  <input type="text" id="pic"><br><br>

  <label>Bill To (Name):</label>
  <input type="text" id="billToName"><br><br>

  <label>Bill To (Rek):</label>
  <input type="text" id="billToRek"><br><br>

  <h3>Items</h3>
  <table id="itemsTable">
    <thead>
      <tr>
        <th>Product Name</th>
        <th>Description</th>
        <th>Amount</th>
        <th>Qty</th>
        <th>Gross Price</th>
        <th>Discount</th>
        <th>Tax</th>
        <th>Net Price</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button type="button" onclick="addRow()">Add Row</button>

  <br><br>
  <button type="button" onclick="submitForm()">Submit Request</button>

  <p id="status"></p>

  <script>
    const scriptURL = https://script.google.com/macros/s/AKfycbwxguu2AkxP__ixF8VbSA4YMwGMw2Pt8j-oN1aYWJ8X1X4KDa760xVOtJkyaCrieygr/exec"; // ganti dengan URL web app dari Apps Script

    function addRow() {
      const table = document.getElementById("itemsTable").getElementsByTagName("tbody")[0];
      const row = table.insertRow();
      const fields = ["productName", "description", "amount", "qty", "grossPrice", "discount", "tax", "netPrice"];
      fields.forEach(f => {
        const cell = row.insertCell();
        const input = document.createElement("input");
        input.type = "text";
        input.name = f;
        cell.appendChild(input);
      });
      const cell = row.insertCell();
      const btn = document.createElement("button");
      btn.innerText = "Delete";
      btn.onclick = () => row.remove();
      cell.appendChild(btn);
    }

    async function submitForm() {
      const date = document.getElementById("date").value;
      const department = document.getElementById("department").value;
      const pic = document.getElementById("pic").value;
      const billToName = document.getElementById("billToName").value;
      const billToRek = document.getElementById("billToRek").value;

      const rows = document.querySelectorAll("#itemsTable tbody tr");
      const items = [];
      rows.forEach(r => {
        const inputs = r.querySelectorAll("input");
        items.push({
          productName: inputs[0].value,
          description: inputs[1].value,
          amount: inputs[2].value,
          qty: inputs[3].value,
          grossPrice: inputs[4].value,
          discount: inputs[5].value,
          tax: inputs[6].value,
          netPrice: inputs[7].value
        });
      });

      const data = { date, department, pic, billToName, billToRek, items };

      document.getElementById("status").innerText = "Submitting...";

      try {
        const response = await fetch(scriptURL, {
          method: "POST",
          headers: { "Content-Type": "application/json" }, // penting!
          body: JSON.stringify(data),
        });

        const result = await response.json();
        if (result.result === "success") {
          document.getElementById("status").innerText = "✅ Submitted successfully!";
        } else {
          document.getElementById("status").innerText = "❌ Error submitting form.";
        }
      } catch (err) {
        document.getElementById("status").innerText = "❌ Network error.";
        console.error(err);
      }
    }
  </script>
</body>
</html>
